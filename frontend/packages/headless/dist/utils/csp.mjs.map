{"version":3,"sources":["../../src/utils/csp.ts"],"names":[],"mappings":";AAQO,SAAS,aAAA,GAAwB;AAEtC,EAAA,IAAI,OAAO,MAAA,KAAW,WAAA,IAAe,MAAA,CAAO,eAAA,EAAiB;AAC3D,IAAA,MAAM,KAAA,GAAQ,IAAI,UAAA,CAAW,EAAE,CAAA;AAC/B,IAAA,MAAA,CAAO,gBAAgB,KAAK,CAAA;AAC5B,IAAA,OAAO,IAAA,CAAK,MAAA,CAAO,YAAA,CAAa,GAAG,KAAK,CAAC,CAAA;AAAA,EAC3C;AAGA,EAAA,MAAM,KAAA,GAAQ,kEAAA;AACd,EAAA,IAAI,MAAA,GAAS,EAAA;AACb,EAAA,KAAA,IAAS,CAAA,GAAI,CAAA,EAAG,CAAA,GAAI,EAAA,EAAI,CAAA,EAAA,EAAK;AAC3B,IAAA,MAAA,IAAU,KAAA,CAAM,OAAO,IAAA,CAAK,KAAA,CAAM,KAAK,MAAA,EAAO,GAAI,KAAA,CAAM,MAAM,CAAC,CAAA;AAAA,EACjE;AACA,EAAA,OAAO,MAAA,GAAS,IAAA;AAClB;AAKO,SAAS,WAAA,CAAY,KAAA,EAAe,aAAA,GAAgB,KAAA,EAAe;AACxE,EAAA,MAAM,QAAA,GAAW;AAAA,IACf,CAAA,kBAAA,CAAA;AAAA;AAAA,IAEA,CAAA,yBAAA,EAA4B,KAAK,CAAA,kBAAA,EAAqB,aAAA,GAAgB,mBAAmB,EAAE,CAAA,CAAA;AAAA;AAAA,IAE3F,CAAA,gBAAA,EAAmB,aAAA,GAAgB,kBAAA,GAAqB,CAAA,QAAA,EAAW,KAAK,CAAA,CAAA,CAAG,CAAA,qBAAA,CAAA;AAAA,IAC3E,CAAA,uCAAA,CAAA;AAAA,IACA,CAAA,iCAAA,CAAA;AAAA,IACA,CAAA,kCAAA,CAAA;AAAA,IACA,CAAA,sBAAA,CAAA;AAAA,IACA,CAAA,eAAA,CAAA;AAAA,IACA,CAAA,kBAAA,CAAA;AAAA,IACA,CAAA,iBAAA,CAAA;AAAA,IACA,CAAA,yBAAA;AAAA,GACF;AAEA,EAAA,OAAO,QAAA,CAAS,KAAK,IAAI,CAAA;AAC3B;AAKO,SAAS,gBAAgB,KAAA,EAAuB;AACrD,EAAA,MAAM,MAAM,WAAA,CAAY,KAAA,EAAO,QAAQ,GAAA,CAAI,UAAU,MAAM,aAAa,CAAA;AACxE,EAAA,OAAO,uDAAuD,GAAG,CAAA,EAAA,CAAA;AACnE;AAKO,SAAS,aAAa,SAAA,EAAkC;AAC7D,EAAA,MAAM,KAAA,GAAQ,SAAA,CAAU,KAAA,CAAM,iBAAiB,CAAA;AAC/C,EAAA,OAAO,KAAA,GAAQ,KAAA,CAAM,CAAC,CAAA,GAAI,IAAA;AAC5B;AAKO,SAAS,aAAa,KAAA,EAAwB;AAEnD,EAAA,OAAO,uBAAA,CAAwB,KAAK,KAAK,CAAA;AAC3C","file":"csp.mjs","sourcesContent":["/**\n * Content Security Policy utilities for nonce generation and management\n */\n\n/**\n * Generate a cryptographically secure nonce for CSP\n * Uses Web Crypto API which is available in both Node.js and Edge Runtime\n */\nexport function generateNonce(): string {\n  // Use crypto.getRandomValues which works in both Node.js and edge runtime\n  if (typeof crypto !== \"undefined\" && crypto.getRandomValues) {\n    const array = new Uint8Array(16);\n    crypto.getRandomValues(array);\n    return btoa(String.fromCharCode(...array));\n  }\n\n  // Fallback for environments without Web Crypto API\n  const chars = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\";\n  let result = \"\";\n  for (let i = 0; i < 22; i++) {\n    result += chars.charAt(Math.floor(Math.random() * chars.length));\n  }\n  return result + \"==\";\n}\n\n/**\n * Generate CSP header with nonce support\n */\nexport function generateCSP(nonce: string, isDevelopment = false): string {\n  const policies = [\n    `default-src 'self'`,\n    // Use nonce for scripts instead of unsafe-inline\n    `script-src 'self' 'nonce-${nonce}' 'strict-dynamic'${isDevelopment ? \" 'unsafe-eval'\" : \"\"}`,\n    // Tightened CSP: Remove unsafe-inline in production, use nonce for inline styles\n    `style-src 'self'${isDevelopment ? \" 'unsafe-inline'\" : ` 'nonce-${nonce}'`} fonts.googleapis.com`,\n    `font-src 'self' fonts.gstatic.com data:`,\n    `img-src 'self' data: blob: https:`,\n    `connect-src 'self' ws: wss: https:`,\n    `frame-ancestors 'none'`,\n    `base-uri 'self'`,\n    `form-action 'self'`,\n    `object-src 'none'`,\n    `upgrade-insecure-requests`,\n  ];\n\n  return policies.join(\"; \");\n}\n\n/**\n * Generate CSP meta tag for client-side enforcement\n */\nexport function generateCSPMeta(nonce: string): string {\n  const csp = generateCSP(nonce, process.env[\"NODE_ENV\"] === \"development\");\n  return `<meta http-equiv=\"Content-Security-Policy\" content=\"${csp}\">`;\n}\n\n/**\n * Extract nonce from CSP header\n */\nexport function extractNonce(cspHeader: string): string | null {\n  const match = cspHeader.match(/'nonce-([^']+)'/);\n  return match ? match[1] : null;\n}\n\n/**\n * Validate nonce format\n */\nexport function isValidNonce(nonce: string): boolean {\n  // Base64 encoded 16 bytes = 24 chars (with padding)\n  return /^[A-Za-z0-9+/]{22}==$/.test(nonce);\n}\n"]}