{"version":3,"sources":["../../src/utils/telemetry.ts"],"names":["OtelResource","ATTR_SERVICE_NAME","ATTR_SERVICE_VERSION","ATTR_DEPLOYMENT_ENVIRONMENT","OTLPTraceExporter","OTLPMetricExporter","NodeSDK","PeriodicExportingMetricReader","getNodeAutoInstrumentations"],"mappings":"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","file":"telemetry.js","sourcesContent":["/**\n * OpenTelemetry initialization for Next.js applications\n */\n\nimport { NodeSDK } from \"@opentelemetry/sdk-node\";\nimport { getNodeAutoInstrumentations } from \"@opentelemetry/auto-instrumentations-node\";\nimport { Resource as OtelResource } from \"@opentelemetry/resources\";\nimport {\n  ATTR_SERVICE_NAME,\n  ATTR_SERVICE_VERSION,\n  ATTR_DEPLOYMENT_ENVIRONMENT,\n} from \"@opentelemetry/semantic-conventions\";\nimport { OTLPTraceExporter } from \"@opentelemetry/exporter-trace-otlp-http\";\nimport { OTLPMetricExporter } from \"@opentelemetry/exporter-metrics-otlp-http\";\nimport { PeriodicExportingMetricReader } from \"@opentelemetry/sdk-metrics\";\n\nlet isInitialized = false;\n\n/**\n * Initialize OpenTelemetry\n */\nexport function initializeOTEL(serviceName: string) {\n  // Prevent multiple initializations\n  if (isInitialized) {\n    console.warn(\"OpenTelemetry already initialized\");\n    return;\n  }\n\n  const otelEndpoint = process.env[\"NEXT_PUBLIC_OTEL_ENDPOINT\"];\n\n  if (!otelEndpoint) {\n    console.log(\"OpenTelemetry endpoint not configured, skipping initialization\");\n    return;\n  }\n\n  try {\n    // Configure resource\n    const resource = OtelResource.default().merge(\n      new OtelResource({\n        [ATTR_SERVICE_NAME]: serviceName,\n        [ATTR_SERVICE_VERSION]: process.env.npm_package_version || \"1.0.0\",\n        [ATTR_DEPLOYMENT_ENVIRONMENT]: process.env[\"NODE_ENV\"] || \"development\",\n      }),\n    );\n\n    // Configure trace exporter\n    const traceExporter = new OTLPTraceExporter({\n      url: `${otelEndpoint}/v1/traces`,\n      headers: {},\n    });\n\n    // Configure metric exporter\n    const metricExporter = new OTLPMetricExporter({\n      url: `${otelEndpoint}/v1/metrics`,\n      headers: {},\n    });\n\n    // Configure SDK\n    const sdk = new NodeSDK({\n      resource,\n      traceExporter,\n      metricReader: new PeriodicExportingMetricReader({\n        exporter: metricExporter,\n        exportIntervalMillis: 10000, // Export metrics every 10 seconds\n      }),\n      instrumentations: [\n        getNodeAutoInstrumentations({\n          \"@opentelemetry/instrumentation-fs\": {\n            enabled: false, // Disable fs instrumentation to reduce noise\n          },\n        }),\n      ],\n    });\n\n    // Initialize SDK\n    sdk.start();\n    isInitialized = true;\n\n    console.log(`âœ… OpenTelemetry initialized for ${serviceName}`);\n    console.log(`   Endpoint: ${otelEndpoint}`);\n    console.log(`   Environment: ${process.env[\"NODE_ENV\"]}`);\n\n    // Graceful shutdown\n    const gracefulShutdown = () => {\n      sdk\n        .shutdown()\n        .then(() => console.log(\"OpenTelemetry terminated\"))\n        .catch((error) => console.error(\"Error terminating OpenTelemetry\", error))\n        .finally(() => process.exit(0));\n    };\n\n    process.on(\"SIGTERM\", gracefulShutdown);\n    process.on(\"SIGINT\", gracefulShutdown);\n  } catch (error) {\n    console.error(\"Failed to initialize OpenTelemetry:\", error);\n  }\n}\n\n/**\n * Custom trace span for manual instrumentation\n */\nexport function createSpan(name: string, attributes?: Record<string, any>) {\n  // This would be implemented with actual OTEL APIs\n  return {\n    end: () => {},\n    setAttribute: (key: string, value: any) => {},\n    setStatus: (status: any) => {},\n  };\n}\n\n/**\n * Record custom metric\n */\nexport function recordMetric(name: string, value: number, attributes?: Record<string, any>) {\n  // This would be implemented with actual OTEL metrics API\n  if (process.env[\"NODE_ENV\"] === \"development\") {\n    console.log(`Metric: ${name} = ${value}`, attributes);\n  }\n}\n\n/**\n * Performance monitoring utilities\n */\nexport const performance = {\n  /**\n   * Measure function execution time\n   */\n  measureTime: async <T>(name: string, fn: () => Promise<T>): Promise<T> => {\n    const start = Date.now();\n    try {\n      const result = await fn();\n      const duration = Date.now() - start;\n      recordMetric(`${name}.duration`, duration);\n      return result;\n    } catch (error) {\n      const duration = Date.now() - start;\n      recordMetric(`${name}.duration`, duration, { error: true });\n      throw error;\n    }\n  },\n\n  /**\n   * Track page load performance\n   */\n  trackPageLoad: (pathname: string) => {\n    if (typeof window !== \"undefined\" && window.performance) {\n      const navigation = window.performance.getEntriesByType(\n        \"navigation\",\n      )[0] as PerformanceNavigationTiming;\n      if (navigation) {\n        recordMetric(\"page.load.time\", navigation.loadEventEnd - navigation.fetchStart, {\n          pathname,\n          domContentLoaded: navigation.domContentLoadedEventEnd - navigation.fetchStart,\n          domInteractive: navigation.domInteractive - navigation.fetchStart,\n        });\n      }\n    }\n  },\n\n  /**\n   * Track API call performance\n   */\n  trackAPICall: (endpoint: string, method: string, duration: number, status: number) => {\n    recordMetric(\"api.call.duration\", duration, {\n      endpoint,\n      method,\n      status,\n      success: status >= 200 && status < 300,\n    });\n  },\n};\n"]}